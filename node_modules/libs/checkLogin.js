var remoteRequest = require('../libs/remoteRequest');

var rp = require('request-promise');
var checkLogin = function(req,res,next) {

	var check = function(req,res,next) {

		if(req.url === '/' || req.url === '/login') {
			next()
		} else {
			var baseRequest = remoteRequest(req,res)
	
			var url = '/testLogin'

			baseRequest.post(url, null, function(err, response, body) {
				if(err) {
					return (function(){res.redirect('/login')})()
				} else {
					obody = JSON.parse(body)
					if(obody.code === 'SUCCESS') {
						return next()
					} 
					else {
						return (function(){res.redirect('/login')})()
					}
				}
				
			})
			
		}
	}

	check(req,res,next);


}

module.exports=checkLogin