var http = require( 'http' );
var qs = require( 'querystring' );
var config = require( '../../config/host.config.json' );
var fs = require('fs');
var request = require('request')


var baseRequest = function(req, res) {
	request.debug = false

	var proxyHeaders = {};
            
	var proxyDomain = ['seashell' , 'clientIp' , 'referer' , 'cookie' , 'user-agent' ];
            
	proxyHeaders.requrl = req.url
    for(var i=0,j = proxyDomain.length ; i < j ;i++ ){
        if (req.headers.hasOwnProperty(proxyDomain[i]) ) {
            proxyHeaders[proxyDomain[i]] = req.headers[proxyDomain[i]]
            }
        }

	var host = config.host + ':' + config.port
	var options = {
		baseUrl: config.baseUrl,
		headers: proxyHeaders
	};

  	var baseRequest = request.defaults(options)

  	var get = function(url, data, callback) {
  		var getOpt = {
  			url: url,
  			method: 'GET',
  			useQuerystring:true
  		}
  		if(data) {
  			getOpt.qs = data
  		}
  		
  		var getRequest = baseRequest.defaults(getOpt);

  		getRequest({},callback)
  	}

  	var post = function(url, data, callback) {
  		
		var postOpt = {
  			url: url,
  			method:'POST',
  			form: data,
  			useQuerystring:false
  		}

  		var postRequest = baseRequest.defaults(postOpt)

  		postRequest({},callback)
  	}

  	return {get:get, post: post}
}


module.exports = baseRequest;
